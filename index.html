<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>PMC Space International | RSS/RO Live Tracker</title>
<style>
html, body {margin:0; height:100%; overflow:hidden; background:#000; font-family:sans-serif; color:#fff;}
#timeLabel {position:fixed; bottom:10px; background: transparent; padding:6px 10px; border-radius:0px; width: 100%; text-align: center;}
#planetSelector {position:absolute; top:50px; left:10px; background:rgba(0,0,0,0); padding:6px 10px; border-radius:6px;}
#infoPanel {position:fixed; border:1px solid rgba(45, 45, 45, 0.5); left:2rem; top:10rem; width:18rem; min-height: 30rem;background:rgba(0, 0, 0, 0.8); padding:30px; border-radius:50px; display:none;}
#infoPanel a {color:darkgray; text-decoration:none; font-size: 1rem;line-height: 3rem;}
#planetDropdown{background: rgba(0,0,0,0.8); color: white; padding: 0.7rem 1.3rem; width: auto; top: 3rem; position: fixed; left: 15rem; border-radius: 7px;}
  #pmc-logo {
    position: fixed;
    top: 0;
    left: 0;
    width: 15rem;
    height: auto;
    fill: white;
    z-index: 1000; /* Ensure it’s on top */
  }
  #vesselName{
    font-weight: bold;
    font-size: 2rem;
    line-height: 3rem;
  }
</style>

</head>
<body>

<svg id="pmc-logo" version="1.2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2560 1440">
  <title>pmc_space_logo</title>
  <path fill="currentColor" d="m621.5 506.04l158.25-0.02c109.76-0.01 160.62 0.32 166 1.08 4.26 0.6 10.9 2.24 14.75 3.63 3.85 1.4 9.25 3.98 12 5.73 2.75 1.76 6.54 4.96 8.43 7.12 1.88 2.16 4.81 6.84 6.5 10.42 2.79 5.92 3.07 7.4 3.06 16.5-0.02 7.47-0.57 11.77-2.21 17-1.21 3.85-4.37 11.27-7.02 16.5-2.65 5.23-21.55 36.05-42 68.5-20.45 32.45-40.24 62.8-43.97 67.45-3.74 4.65-10.39 11.54-14.79 15.31-4.4 3.77-11.6 9.27-16 12.23-4.4 2.96-12.73 7.63-18.5 10.38-5.77 2.76-14.1 6.21-18.5 7.68-4.4 1.46-12.27 3.58-17.5 4.69-8.94 1.91-14.21 2.07-170.61 3.26l-7.44 3.69c-4.38 2.17-9.39 5.68-12.15 8.5-2.96 3.03-19.15 27.9-43.82 67.31-24.42 39.01-40.88 64.3-43.8 67.3-2.58 2.64-7.38 6.14-10.68 7.76-3.3 1.63-8.7 3.41-12 3.95-3.53 0.57-35.21 0.97-77 0.96-39.8-0.01-72.76-0.42-75-0.94-2.2-0.51-5.01-2.07-6.25-3.48-1.49-1.68-2.25-3.82-2.24-6.3 0.01-2.06 1.05-6 2.32-8.75 1.27-2.75 56.26-91.4 122.21-197 65.94-105.6 121.49-193.75 123.43-195.88 1.94-2.13 5.33-5.27 7.53-6.97 2.2-1.7 6.92-4.11 10.5-5.35zm479-0.02l278 0.27c266.11 0.25 278.3 0.34 285 2.1 3.85 1.01 10.15 3.28 14 5.04 4.03 1.85 8.91 5.11 11.5 7.68 2.47 2.46 5.56 6.71 6.87 9.43 1.3 2.73 2.73 7.65 3.17 10.95 0.46 3.43 0.39 8.8-0.16 12.5-0.53 3.58-2.07 9.77-3.42 13.75-1.36 3.99-4.1 10.52-6.1 14.5-2.01 3.99-7.11 12.88-11.34 19.75-4.22 6.88-49.86 80.23-101.42 163-77.66 124.69-94.71 151.45-99.42 156.03-3.89 3.78-7.89 6.46-19.68 11.47h-76.5c-65.83 0-76.97-0.2-79.89-1.5-1.86-0.82-4-2.73-4.75-4.25-0.75-1.51-1.37-3.53-1.38-4.5-0.01-0.96 0.69-3.77 1.56-6.25 0.86-2.47 52.27-85.72 114.23-185 61.95-99.27 113.34-182.38 114.19-184.68 1.15-3.12 1.28-4.89 0.53-7-0.58-1.61-2.5-3.58-4.5-4.62-2.91-1.5-5.24-1.73-13.99-1.37-5.78 0.24-12.08 0.91-14 1.5-1.92 0.58-6.4 3-9.94 5.37-3.54 2.37-8.12 6.33-10.17 8.8-2.05 2.48-54.39 85.73-116.3 185-61.91 99.28-114.38 182.64-116.58 185.25-2.79 3.31-6.22 5.82-11.26 8.26-3.99 1.92-9.72 3.95-12.75 4.51-3.35 0.61-31.15 1-71 0.99-46.03-0.01-66.69-0.36-69.5-1.16-2.2-0.63-5.01-2.2-6.25-3.49-1.31-1.37-2.25-3.61-2.25-5.36 0-1.65 0.82-5.13 1.83-7.75 1-2.61 52.38-85.75 114.18-184.75 61.8-99 113-182.02 113.79-184.5 1.21-3.81 1.22-4.92 0.06-7.3-0.75-1.54-2.82-3.45-4.61-4.25-2-0.89-6.43-1.44-11.5-1.43-4.54 0-10.5 0.61-13.25 1.34-2.75 0.74-7.03 2.38-9.5 3.64-2.47 1.27-7.2 5.06-10.5 8.42-4.91 5.01-26.51 39.03-119 187.45-62.15 99.73-114.8 183.36-117 185.84-2.54 2.86-6.56 5.76-11 7.91-3.85 1.86-9.48 3.84-12.5 4.4-3.38 0.62-32.87 0.99-76.5 0.97-39.74-0.02-72.76-0.44-75-0.96-2.2-0.5-5.01-2.07-6.25-3.47-1.49-1.69-2.25-3.83-2.24-6.31 0.01-2.06 1.05-6 2.32-8.75 1.27-2.75 56.26-91.4 122.21-197 65.94-105.6 121.49-193.74 123.43-195.87 1.94-2.14 5.33-5.27 7.53-6.98 2.2-1.7 6.92-4.11 10.5-5.35zm916.75 0.1c173.16-0.13 183.95-0.03 187.24 1.62 1.91 0.96 3.94 2.76 4.5 4 0.55 1.23 1 3.26 0.99 4.5-0.01 1.23-0.95 4.27-2.07 6.75-1.13 2.47-22.58 36.45-47.66 75.5-25.09 39.05-47.36 73.25-49.5 76-2.14 2.75-5.77 6.52-8.07 8.38-2.3 1.86-6.65 4.56-15.18 8.62l-75.5 0.3c-41.53 0.16-77.3 0.06-79.5-0.23-2.3-0.31-5.17-1.61-6.75-3.05-2-1.83-2.75-3.48-2.75-6.02 0-1.93 1.05-5.64 2.33-8.25 1.28-2.62 19.6-31.53 40.71-64.25 21.35-33.11 39-61.5 39.78-64 1.19-3.81 1.2-4.93 0.04-7.3-0.75-1.55-2.82-3.46-4.61-4.25-2-0.89-6.43-1.45-11.5-1.44-4.54 0-10.5 0.61-13.25 1.35-2.75 0.73-7.03 2.37-9.5 3.64-2.47 1.26-7.2 5.05-10.5 8.41-4.93 5.02-24.42 35.79-109.64 173.1-57 91.84-104.36 168.45-105.25 170.24-0.89 1.8-1.5 5.09-1.36 7.4 0.19 3.23 0.88 4.61 3.08 6.25 2.49 1.85 4.21 2.1 14.5 2.1 11.18 0 11.97-0.15 18.67-3.35 4.73-2.27 8.95-5.35 13.03-9.5 4.73-4.82 13.93-18.88 42.5-64.95 20.06-32.33 38.27-61 40.47-63.71 2.2-2.71 6.47-6.76 9.5-9.02 3.03-2.25 7.97-5.08 11-6.28 5.47-2.18 5.96-2.2 157.5-2.74l4.45 2.27c2.68 1.37 4.79 3.27 5.3 4.78 0.51 1.48 0.43 4.12-0.2 6.5-0.57 2.2-22.16 37.97-47.96 79.5-30.72 49.45-48.58 77.23-51.75 80.52-2.73 2.83-7.68 6.44-11.34 8.26-3.58 1.78-8.75 3.69-11.5 4.24-3.28 0.66-68.03 0.92-371 0.48l-5.5-2.19c-3.32-1.32-6.99-3.8-9.25-6.25-2.06-2.23-4.04-5.3-4.38-6.81-0.35-1.52-0.45-5.45-0.22-8.75 0.27-3.93 1.48-8.25 3.49-12.5 1.69-3.58 50.89-83.23 109.32-177 58.43-93.78 108.1-172.93 110.39-175.89 2.28-2.97 6.85-7.92 10.15-11.01 3.3-3.1 10.05-8.14 15-11.21 4.95-3.06 11.92-6.73 15.5-8.15 3.58-1.42 8.97-3.26 12-4.11 3.03-0.84 6.62-1.71 8-1.94 1.37-0.23 85.19-0.48 186.25-0.56zm-1230.25 28.26c-2.48 0.66-6.52 2.39-9 3.83-2.48 1.45-6.25 4.35-8.39 6.45-2.13 2.11-5.55 6.3-7.58 9.33-2.03 3.02-27.25 43.3-56.04 89.5-28.79 46.2-52.91 85.8-53.6 88-0.75 2.41-0.94 5.18-0.48 7 0.43 1.65 2 3.9 3.5 5 2.18 1.6 4.67 2.06 12.41 2.34 7.88 0.27 10.8-0.05 15.68-1.76 3.3-1.16 8.44-3.79 11.42-5.84 2.98-2.06 7.1-5.99 9.17-8.74 2.06-2.75 27.46-43.03 56.43-89.5 28.98-46.48 53.76-86.64 55.08-89.25 1.32-2.62 2.4-6.1 2.4-7.75 0-1.65-0.45-3.9-1-5-0.55-1.1-2.35-2.68-4-3.5-2.07-1.04-5.87-1.48-12.25-1.41-5.09 0.04-11.27 0.63-13.75 1.3zm1431.36 121.5l2.57 1.71c1.41 0.94 8.42 5.87 15.57 10.94 7.15 5.08 17.5 12.99 23 17.57 5.5 4.58 15.43 13.74 22.06 20.36 6.64 6.61 15.64 16.53 20 22.03 4.37 5.5 10.39 13.82 13.38 18.5 3 4.67 7.8 13.45 10.68 19.5 2.87 6.05 6.34 14.82 7.71 19.5 1.36 4.67 3.03 12.32 3.71 17 0.75 5.16 1.03 13.4 0.71 21-0.4 9.4-1.18 14.66-3.14 21.25-1.44 4.81-3.73 11.45-5.11 14.75-1.37 3.3-4.84 9.93-7.71 14.75-2.86 4.81-8.65 13.02-12.87 18.25-4.22 5.22-11.44 13.11-16.05 17.53-4.6 4.43-13.09 11.81-18.87 16.4-5.78 4.6-16.8 12.51-24.5 17.57-7.7 5.06-19.4 12.27-26 16.04-6.6 3.76-20.21 10.8-30.25 15.65-10.04 4.84-24.66 11.54-32.5 14.87-7.84 3.34-19.43 8.12-25.75 10.64-6.32 2.51-18.03 6.78-26 9.49-7.97 2.71-21.47 6.9-30 9.29-8.53 2.4-23.15 6.18-32.5 8.39-9.35 2.21-23.97 5.38-32.5 7.02-8.53 1.65-23.82 4.4-34 6.11-10.17 1.71-32.22 4.85-49 6.98-16.78 2.14-40.17 4.8-52 5.93-11.82 1.13-37.25 3.17-56.5 4.54-19.25 1.37-52.1 3.28-73 4.26-31.6 1.47-57.64 1.76-154.5 1.73-91.25-0.03-126.36-0.41-162-1.76-25.03-0.95-64.62-2.61-88-3.7-23.37-1.09-54.65-2.67-69.5-3.52-14.85-0.84-44.1-2.64-65-4.01-20.9-1.36-50.82-3.39-66.5-4.5-15.67-1.12-42.22-3.14-59-4.5-16.78-1.37-44.45-3.61-61.5-4.98-17.05-1.38-37.75-3.17-46-3.98-8.25-0.8-25.35-2.39-38-3.51-12.65-1.13-51.8-4.95-87-8.49-35.2-3.55-88.52-9.16-118.5-12.49-29.97-3.32-73.4-8.31-96.5-11.08-23.1-2.78-61.35-7.47-85-10.44-23.65-2.96-58.97-7.46-78.5-9.99-19.52-2.53-53.72-7.27-116.5-16.44l19 0.5c10.45 0.27 29.13 0.93 41.5 1.46 12.38 0.53 34.43 1.42 49 1.98 14.58 0.56 44.28 1.69 66 2.51 21.73 0.82 60.43 2.15 86 2.96 25.58 0.81 60.45 1.94 77.5 2.52 17.05 0.57 56.88 1.71 88.5 2.53 31.63 0.82 77.3 1.94 101.5 2.48 24.2 0.55 85.63 1.76 136.5 2.7 68.54 1.26 140.04 1.7 276 1.69 145.77 0 197.48-0.35 251.5-1.71 37.4-0.94 86.9-2.38 110-3.2 23.1-0.82 55.5-2.17 72-3 16.5-0.83 41.7-2.18 56-3 14.3-0.82 38.15-2.39 53-3.48 14.85-1.09 32.4-2.45 39-3.02 6.6-0.57 25.28-2.38 41.5-4.03 16.22-1.64 34.9-3.66 41.5-4.49 6.6-0.83 15.83-2.2 20.5-3.06 4.68-0.85 13.45-3.13 19.5-5.07 6.05-1.94 16.4-6.15 23-9.35 6.6-3.21 17.4-9.41 24-13.78 6.6-4.38 16.95-12.22 23-17.44 6.05-5.22 14.6-13.26 19.01-17.87 4.4-4.61 10.71-11.53 14.02-15.38 3.3-3.85 9.42-11.5 13.59-17 4.16-5.5 11.64-16.08 16.61-23.5 4.97-7.43 12.53-19.58 16.8-27 4.28-7.43 12.17-22.28 17.54-33 5.37-10.73 13.12-27.38 17.24-37 4.11-9.63 10.4-25.38 13.98-35 3.58-9.63 8.66-24.16 11.29-32.31z"/>
</svg>
<div id="timeLabel">UTC: <span id="utcTime">—</span></div>
<div id="planetSelector">
<select id="planetDropdown">
  <option value="earth">Earth</option>
  <option value="moon">Moon</option>
  <option value="mars">Mars</option>
</select>
</div>
<div id="infoPanel">
<div id="vesselName"></div>
<div id="vesselDesc"></div>
<a id="vesselYT" target="_blank">Watch More</a>

<script src="https://cdn.jsdelivr.net/npm/three@0.141.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.141.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fflate@0.7.5/umd/fflate.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.141.0/examples/js/loaders/EXRLoader.js"></script>
<script>
// Constants
const planetGM = { earth: 3.986004418e14, moon: 4.9048695e12, mars: 4.282837e13 };
const planetTextures = { earth:'earth.jpg', moon:'moon.png', mars:'mars.jpg' };



// Vessels
let vessels = []; // empty initially

fetch('vessels.json')
  .then(response => response.json())
  .then(data => {
    vessels = data;
    createPlanet(currentPlanet); // call planet setup after vessels load
  })
  .catch(err => console.error("Failed to load vessels.json:", err));

// Scene setup
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 1e8);
camera.position.set(0,0,1.2e7);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);
const controls = new THREE.OrbitControls(camera, renderer.domElement);

                       
// Smooth motion
controls.enableDamping = true;      // enables smooth camera movement
controls.dampingFactor = 0.05;      // smaller = smoother but slower

// Adjust speeds
controls.zoomSpeed = 1;           // lower = finer control
controls.rotateSpeed = 0.5;         // optional: slower rotation
controls.panSpeed = 0.5;            // optional: slower panning

// Limit zoom range
controls.minDistance = 2e5;         // closest you can zoom in
controls.maxDistance = 5e7;         // farthest you can zoom out         

// Load EXR environment
const loader = new THREE.TextureLoader();
loader.load(
  'starmap.jpg',  // replace with your PNG URL
  function (texture) {
    texture.mapping = THREE.EquirectangularReflectionMapping;
    scene.background = texture;     // sets the background
    scene.environment = texture;    // affects reflections & PBR materials
  },
  undefined,
  function (err) {
    console.error('Failed to load PNG texture:', err);
  }
);


scene.add(new THREE.AmbientLight(0xffffff,0.2));
const dirLight = new THREE.DirectionalLight(0xffffff,1);
dirLight.position.set(9e6,9e6,9e6); scene.add(dirLight);

// Circle sprite texture
function createCircleTexture(color='white', size=64){
  const canvas=document.createElement('canvas'); canvas.width=canvas.height=size;
  const ctx=canvas.getContext('2d');
  ctx.fillStyle=color; ctx.beginPath();
  ctx.arc(size/2,size/2,size/2,0,Math.PI*2); ctx.fill();
  return new THREE.CanvasTexture(canvas);
}
const circleTex=createCircleTexture('white',64);

// Globals
let currentPlanet='earth', planetMesh;
let vesselSprites=[], orbitLines=[];

// Planet + vessels
function createPlanet(name){
  if(planetMesh) scene.remove(planetMesh);

  const radius = name==='moon'?1737e3:name==='earth'?6371e3:3390e3;
  planetMesh = new THREE.Mesh(
    new THREE.SphereGeometry(radius,64,64),
    new THREE.MeshStandardMaterial({map:new THREE.TextureLoader().load(planetTextures[name])})
  );
  scene.add(planetMesh);

  // cleanup old
  vesselSprites.forEach(vs=>{
    scene.remove(vs.mesh);
    scene.remove(vs.label);
  });
  orbitLines.forEach(o=>scene.remove(o.line));
  vesselSprites=[]; orbitLines=[];

  vessels.filter(vessel=>vessel.centralBody===name).forEach((vessel,i)=>{
    // Indicator
    const mat = new THREE.SpriteMaterial({map:circleTex, depthTest:false});
    const sprite = new THREE.Sprite(mat);
    sprite.renderOrder=999; 
    scene.add(sprite);

    // Label texture
const canvas = document.createElement('canvas');
canvas.width = 512;   // wider to prevent cropping
canvas.height = 64;   // keep same height
const ctx = canvas.getContext('2d');
ctx.font = 'Bold 48px sans-serif'; // high resolution
ctx.fillStyle = 'white';
ctx.textAlign = 'center';
ctx.textBaseline = 'middle';
ctx.fillText(vessel.info.name, canvas.width / 2, canvas.height / 2); // center text
const texture = new THREE.CanvasTexture(canvas);
texture.minFilter = THREE.LinearFilter;
const labelMat = new THREE.SpriteMaterial({ map: texture, transparent: true, depthTest: false });
const label = new THREE.Sprite(labelMat);
scene.add(label);

    vesselSprites.push({mesh:sprite,label,data:vessel,orbitIndex:i});

    // Orbit line
    const steps=256; const points=[]; const alphas=new Float32Array(steps+1);
    for(let j=0;j<=steps;j++){
      const M=2*Math.PI*j/steps;
      points.push(keplerToCartesian(vessel.a,vessel.e,vessel.i,vessel.raan,vessel.argPeri,M));
      alphas[j]=0;
    }
    const geometry=new THREE.BufferGeometry().setFromPoints(points);
    geometry.setAttribute('alpha', new THREE.BufferAttribute(alphas,1));
    const material=new THREE.ShaderMaterial({
      uniforms:{color:{value:new THREE.Color(0xffffff)}},
      vertexShader:`attribute float alpha; varying float vAlpha; 
        void main(){vAlpha=alpha; gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}`,
      fragmentShader:`uniform vec3 color; varying float vAlpha; 
        void main(){gl_FragColor=vec4(color,vAlpha);}`,
      transparent:true, depthTest:false
    });
    const line=new THREE.Line(geometry,material); scene.add(line);
    orbitLines.push({line,points,alphas});
  });
}
createPlanet(currentPlanet);
document.getElementById('planetDropdown').addEventListener('change',e=>{
  currentPlanet=e.target.value; createPlanet(currentPlanet);
});

// Kepler → Cartesian
function keplerToCartesian(a,e,i,raan,argPeri,M){
  const E=M;
  let x=a*(Math.cos(E)-e); let y=a*Math.sqrt(1-e*e)*Math.sin(E); let z=0;
  const cosAP=Math.cos(argPeri), sinAP=Math.sin(argPeri);
  let x1=x*cosAP - y*sinAP, y1=x*sinAP + y*cosAP, z1=z;
  const cosI=Math.cos(i), sinI=Math.sin(i);
  let x2=x1, y2=y1*cosI - z1*sinI, z2=y1*sinI + z1;
  const cosR=Math.cos(raan), sinR=Math.sin(raan);
  return new THREE.Vector3(x2*cosR - y2*sinR, x2*sinR + y2*cosR, z2);
}

// Animate
function animate(){
  requestAnimationFrame(animate);
  const now = Date.now()/1000;

  // Rotate planet
  if(currentPlanet==='earth') planetMesh.rotation.y += (2*Math.PI)/(24*60*60)/60;
  if(currentPlanet==='moon') planetMesh.rotation.y += (2*Math.PI)/(27.3*24*60*60)/60;
  if(currentPlanet==='mars') planetMesh.rotation.y += (2*Math.PI)/(24.6*60*60)/60;

              // Animate
function animate(){
  requestAnimationFrame(animate);
  const now = Date.now()/1000;

  // Rotate planet
  if(currentPlanet==='earth') planetMesh.rotation.y += (2*Math.PI)/(24*60*60)/60;
  if(currentPlanet==='moon') planetMesh.rotation.y += (2*Math.PI)/(27.3*24*60*60)/60;
  if(currentPlanet==='mars') planetMesh.rotation.y += (2*Math.PI)/(24.6*60*60)/60;
function getWorldScaleAtDistance(camera, distance, desiredPixelSize) {
    // desiredPixelSize = how big you want it on screen in pixels
    const vFOV = camera.fov * (Math.PI / 180); // vertical fov in radians
    const viewportHeight = 2 * Math.tan(vFOV / 2) * distance; // height at distance
    const worldPerPixel = viewportHeight / window.innerHeight;
    return worldPerPixel * desiredPixelSize;
}

vesselSprites.forEach((vs, i) => {
    const mu = planetGM[vs.data.centralBody];
    const n = Math.sqrt(mu / Math.pow(vs.data.a, 3));
    const M = vs.data.M0 - n * (now - vs.data.epoch);
    const pos = keplerToCartesian(vs.data.a, vs.data.e, vs.data.i, vs.data.raan, vs.data.argPeri, M);
    vs.mesh.position.copy(pos);

    // Indicator: keep fixed size on screen
    const dist = camera.position.distanceTo(pos);
    const indicatorPixelSize = 16; // desired size in pixels
    const worldScale = getWorldScaleAtDistance(camera, dist, indicatorPixelSize);
    vs.mesh.scale.set(worldScale, worldScale, 1);

    // Label: same idea
    const labelOffset = worldScale * 1.5; // slightly above indicator
    const labelPos = pos.clone();
    labelPos.y += labelOffset;
    vs.label.position.copy(labelPos);

    const tex = vs.label.material.map;
    const aspect = tex.image.width / tex.image.height;
    vs.label.scale.set(worldScale * aspect, worldScale, 1);

    const camQuat = camera.quaternion.clone();
    const euler = new THREE.Euler().setFromQuaternion(camQuat);
    euler.x = 0; euler.z = 0;
    vs.label.quaternion.setFromEuler(euler);

    // Orbit fade (unchanged)
    const orbit = orbitLines[vs.orbitIndex];
    const idx = Math.floor(((M % (2 * Math.PI)) / (2 * Math.PI)) * orbit.points.length);
    for (let j = 0; j < orbit.points.length; j++) {
        const diff = (j - idx + orbit.points.length) % orbit.points.length;
        orbit.alphas[j] = Math.max(0, 0.3 * (1 - diff / orbit.points.length));
    }
    orbit.line.geometry.attributes.alpha.needsUpdate = true;
});

  document.getElementById('utcTime').textContent=new Date().toISOString().replace('T',' ').replace('Z',' UTC');
  controls.update(); renderer.render(scene,camera);
}
animate();

  document.getElementById('utcTime').textContent=new Date().toISOString().replace('T',' ').replace('Z',' UTC');
  controls.update(); renderer.render(scene,camera);
}
animate();

// Click handler
renderer.domElement.addEventListener('pointerdown', e=>{
  const mouse=new THREE.Vector2();
  mouse.x=(e.clientX/window.innerWidth)*2-1;
  mouse.y=-(e.clientY/window.innerHeight)*2+1;
  const ray=new THREE.Raycaster(); ray.setFromCamera(mouse,camera);
  const hit=vesselSprites.find(v=>ray.intersectObject(v.mesh).length>0);
  if(hit){
    const v=hit.data;
    document.getElementById('vesselName').innerText=v.info.name;
    document.getElementById('vesselDesc').innerText=v.info.description;
    const yt=document.getElementById('vesselYT'); yt.href=v.info.youtube; yt.style.display='block';
    document.getElementById('infoPanel').style.display='block';
  }
});

window.addEventListener('resize',()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
