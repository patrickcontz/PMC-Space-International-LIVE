<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>KSP Tracker Test</title>
<style>
  html,body {margin:0; height:100%; overflow:hidden; background:#000; color:#fff; font-family:sans-serif;}
  #timeLabel {position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.6); padding:6px 10px; border-radius:6px;}
  #planetControls {position:absolute; top:50px; left:10px; background:rgba(0,0,0,0.6); padding:6px 10px; border-radius:6px;}
  #planetControls button {margin-right:5px; padding:5px 10px; cursor:pointer;}
</style>
</head>
<body>
<div id="timeLabel">UTC: <span id="utcTime">â€”</span></div>
<div id="planetControls">
  <button onclick="switchPlanet('Earth')">Earth</button>
  <button onclick="switchPlanet('Moon')">Moon</button>
  <button onclick="switchPlanet('Mars')">Mars</button>
</div>

<!-- Three.js r141 + OrbitControls (globally available) -->
<script src="https://cdn.jsdelivr.net/npm/three@0.141.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.141.0/examples/js/controls/OrbitControls.js"></script>

<script>
try {
  // Scene, Camera, Renderer
  let scene = new THREE.Scene();
  let camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1e8);
  camera.position.set(0,0,5e7);

  let renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  let controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.05;

  // Light
  let light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5e7,5e7,5e7);
  scene.add(light);

  // Planet textures
  const planetTextures = {
    Earth: 'earth.jpg',
    Moon: 'moon.png',
    Mars: 'mars.jpg'
  };
  const planetRadii = {
    Earth: 6371e3,
    Moon: 1737e3,
    Mars: 3389e3
  };

  let currentPlanet = 'Earth';
  let planetMesh;
  const loader = new THREE.TextureLoader();

  function createPlanet(name) {
    if(planetMesh) scene.remove(planetMesh);
    let geometry = new THREE.SphereGeometry(planetRadii[name], 64, 64);
    let material = new THREE.MeshBasicMaterial({ map: loader.load(planetTextures[name]) });
    planetMesh = new THREE.Mesh(geometry, material);
    scene.add(planetMesh);
  }

  createPlanet(currentPlanet);

  window.switchPlanet = function(name) {
    currentPlanet = name;
    createPlanet(name);
  }

  // Animate
  function animate(){
    requestAnimationFrame(animate);
    if(planetMesh) planetMesh.rotation.y += 0.001;
    document.getElementById('utcTime').textContent =
      new Date().toISOString().replace('T',' ').replace('Z',' UTC');
    controls.update();
    renderer.render(scene, camera);
  }
  animate();

  window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
} catch (err) {
  console.error("Error in script:", err);
  document.body.innerHTML = "<h1 style='color:red'>JS ERROR</h1><pre>"+err+"</pre>";
}
</script>
</body>
</html>
