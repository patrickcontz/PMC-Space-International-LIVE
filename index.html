<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PMC Space International | KSP RSS/RO Mission Tracker</title>
<style>
  html,body { height:100%; margin:0; font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial; background:#0b0b0b; color:#ddd; }
  canvas { display:block; }
  #ui { position:absolute; left:10px; top:10px; z-index:10; background:rgba(0,0,0,0.45); padding:10px; border-radius:8px; min-width:220px; }
  #ui h3{ margin:0 0 8px 0; font-size:15px; color:#fff; }
  #ui select{ width:100%; margin:6px 0; padding:8px; }
  #timeLabel{ font-size:12px; margin-top:6px; color:#ccc; }
  #legend{ position:absolute; right:10px; top:10px; z-index:9; background:rgba(0,0,0,0.35); padding:8px; border-radius:8px; color:#ddd; font-size:12px; }
  #infoPanel{ display:none; position:absolute; bottom:20px; left:20px; width:300px; background:rgba(0,0,0,0.8); padding:12px; border-radius:8px; color:#eee; font-size:14px; z-index:20; }
  #infoPanel h3{ margin:0 0 6px 0; font-size:16px; color:#fff; }
</style>
</head>
<body>
<div id="ui">
  <h3>Planet Viewer</h3>
  <label>Planet</label>
  <select id="planetSelect">
    <option value="earth" selected>Earth</option>
    <option value="moon">Moon</option>
    <option value="mars">Mars</option>
  </select>
  <div id="timeLabel">UTC: <span id="utcTime">â€”</span></div>
</div>

<div id="legend">Controls: drag to rotate, scroll to zoom. Click vessel markers for details.</div>

<div id="infoPanel">
  <div id="infoContent"></div>
  <button onclick="closeInfo()" style="margin-top:10px; width:100%; padding:6px;">Close</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.156.1/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/controls/OrbitControls.js"></script>
<script>
const PLANETS = {
  earth: {
    name: "Earth",
    radius_m: 6371000,
    texture: "https://threejs.org/examples/textures/land_ocean_ice_cloud_2048.jpg",
    mu: 3.986004418e14
  },
  moon: {
    name: "Moon",
    radius_m: 1737100,
    texture: "https://threejs.org/examples/textures/moon_1024.jpg",
    mu: 4.9048695e12
  },
  mars: {
    name: "Mars",
    radius_m: 3389500,
    texture: "https://www.solarsystemscope.com/textures/download/2k_mars.jpg",
    mu: 4.282837e13
  }
};

let scene,camera,renderer,controls;
let planetMesh=null,planetGroup,orbitLinesGroup;
let vessels=[];
const DISTANCE_SCALE=1e-6, MIN_RENDER_SCALE=1e-7;
let raycaster=new THREE.Raycaster(),mouse=new THREE.Vector2();

init();
animate();
loadVessels();

function init(){
  scene=new THREE.Scene();
  camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,0.01,1e9);
  camera.position.set(0,2,6);
  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(window.innerWidth,window.innerHeight);
  document.body.appendChild(renderer.domElement);
  controls=new THREE.OrbitControls(camera,renderer.domElement);
  controls.enableDamping=true;
  scene.add(new THREE.DirectionalLight(0xffffff,1).position.set(5,2,2));
  scene.add(new THREE.AmbientLight(0x606060));
  planetGroup=new THREE.Group(); scene.add(planetGroup);
  orbitLinesGroup=new THREE.Group(); scene.add(orbitLinesGroup);
  createPlanet('earth');
  document.getElementById('planetSelect').addEventListener('change',e=>createPlanet(e.target.value));
  window.addEventListener('resize',onResize);
  window.addEventListener('click',onMouseClick,false);
}
function createPlanet(key){
  const p=PLANETS[key];
  if(planetMesh){ planetGroup.remove(planetMesh); planetMesh.geometry.dispose(); }
  const radiusScene=Math.max(p.radius_m*DISTANCE_SCALE,p.radius_m*MIN_RENDER_SCALE);
  const geometry=new THREE.SphereGeometry(radiusScene,64,64);
  const texture=new THREE.TextureLoader().load(p.texture);
  const material=new THREE.MeshStandardMaterial({map:texture});
  planetMesh=new THREE.Mesh(geometry,material);
  planetMesh.userData={radius_m:p.radius_m,key};
  planetGroup.add(planetMesh);
  controls.target.set(0,0,0);
  camera.position.set(radiusScene*4,radiusScene*1.2,radiusScene*4);
  controls.update();
}
function animate(){
  requestAnimationFrame(animate);
  const simEpoch=Math.floor(Date.now()/1000);
  document.getElementById('utcTime').textContent=new Date(simEpoch*1000).toISOString().replace('T',' ').replace('Z',' UTC');
  controls.update();
  renderer.render(scene,camera);
}
function onResize(){
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
}
function onMouseClick(e){ /* vessel click will go here later */ }
function closeInfo(){ document.getElementById('infoPanel').style.display='none'; }
function loadVessels(){ fetch("vessels.json").then(r=>r.json()).then(d=>console.log("Loaded vessels:",d)); }
</script>
</body>
</html>
